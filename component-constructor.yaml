# yaml-language-server: $schema=https://ocm.software/schemas/configuration-schema.yaml

components:
  - name: github.com/openmcp-project/openmcp
    labels:
    - name: "org.opencontainers.image.source"
      value: "https://github.com/openmcp-project/openmcp"
    version: "${OPENMCP_VERSION}"
    provider:
      name: openmcp-project
    componentReferences:
      - componentName: github.com/openmcp-project/mcp-operator
        name: mcp-operator
        version: ${MCP_OPERATOR_VERSION}
      
      - componentName: github.com/openmcp-project/openmcp-operator
        name: openmcp-operator
        version: ${OPENMCP_OPERATOR_VERSION}

      - componentName: github.com/openmcp-project/gitops-templates
        name: gitops-templates
        version: ${GITOPS_TEMPLATES_VERSION}

      - componentName: github.com/openmcp-project/control-plane-operator
        name: control-plane-operator
        version: ${CONTROL_PLANE_OPERATOR_VERSION}

      - componentName: github.com/openmcp-project/quota-operator
        name: quota-operator
        version: ${QUOTA_OPERATOR_VERSION}

      - componentName: github.com/openmcp-project/project-workspace-operator
        name: project-workspace-operator
        version: ${PROJECT_WORKSPACE_OPERATOR_VERSION}

      - componentName: github.com/openmcp-project/bootstrapper
        name: bootstrapper
        version: ${BOOTSTRAPPER_VERSION}

      # Service Providers

      - componentName: github.com/openmcp-project/service-provider-landscaper
        name: service-provider-landscaper
        version: ${SERVICE_PROVIDER_LANDSCAPER_VERSION}

      - componentName: github.com/openmcp-project/service-provider-crossplane
        name: service-provider-crossplane
        version: ${SERVICE_PROVIDER_CROSSPLANE_VERSION}

      # Cluster Providers

      - componentName: github.com/openmcp-project/cluster-provider-gardener
        name: cluster-provider-gardener
        version: ${CLUSTER_PROVIDER_GARDENER_VERSION}

      - componentName: github.com/openmcp-project/cluster-provider-kind
        name: cluster-provider-kind
        version: ${CLUSTER_PROVIDER_KIND_VERSION}

      # Platform Services

      - componentName: github.com/openmcp-project/platform-service-dns
        name: platform-service-dns
        version: ${PLATFORM_SERVICE_DNS_VERSION}

      - componentName: github.com/openmcp-project/platform-service-gateway
        name: platform-service-gateway
        version: ${PLATFORM_SERVICE_GATEWAY_VERSION}

    resources:
      - name: external-dns-chart
        type: helmChart
        input:
          type: helm
          helmRepository: https://kubernetes-sigs.github.io/external-dns
          path: external-dns
          version: 1${EXTERNAL_DNS_VERSION#v0}
          repository: charts/external-dns
      
      - name: external-dns-image
        version: ${EXTERNAL_DNS_VERSION}
        type: ociImage
        input:
          type: ociImage
          path: registry.k8s.io/external-dns/external-dns:${EXTERNAL_DNS_VERSION}
          repository: images/external-dns

      - name: fluxcd-source-controller
        version: ${FLUXCD_SOURCE_CONTROLLER_VERSION}
        type: ociImage
        input:
          type: ociImage
          path: ghcr.io/fluxcd/source-controller:${FLUXCD_SOURCE_CONTROLLER_VERSION}
          repository: images/fluxcd/source-controller

      - name: fluxcd-kustomize-controller
        version: ${FLUXCD_KUSTOMIZE_CONTROLLER_VERSION}
        type: ociImage
        input:
          type: ociImage
          path: ghcr.io/fluxcd/kustomize-controller:${FLUXCD_KUSTOMIZE_CONTROLLER_VERSION}
          repository: images/fluxcd/kustomize-controller

      - name: fluxcd-helm-controller
        version: ${FLUXCD_HELM_CONTROLLER_VERSION}
        type: ociImage
        input:
          type: ociImage
          path: ghcr.io/fluxcd/helm-controller:${FLUXCD_HELM_CONTROLLER_VERSION}
          repository: images/fluxcd/helm-controller

      - name: fluxcd-notification-controller
        version: ${FLUXCD_NOTIFICATION_CONTROLLER_VERSION}
        type: ociImage
        input:
          type: ociImage
          path: ghcr.io/fluxcd/notification-controller:${FLUXCD_NOTIFICATION_CONTROLLER_VERSION}
          repository: images/fluxcd/notification-controller

      - name: fluxcd-image-reflector-controller
        version: ${FLUXCD_IMAGE_REFLECTOR_CONTROLLER_VERSION}
        type: ociImage
        input:
          type: ociImage
          path: ghcr.io/fluxcd/image-reflector-controller:${FLUXCD_IMAGE_REFLECTOR_CONTROLLER_VERSION}
          repository: images/fluxcd/image-reflector-controller

      - name: fluxcd-image-automation-controller
        version: ${FLUXCD_IMAGE_AUTOMATION_CONTROLLER_VERSION}
        type: ociImage
        input:
          type: ociImage
          path: ghcr.io/fluxcd/image-automation-controller:${FLUXCD_IMAGE_AUTOMATION_CONTROLLER_VERSION}
          repository: images/fluxcd/image-automation-controller

      - name: external-secrets-operator-chart
        type: helmChart
        input:
          type: helm
          helmRepository: https://charts.external-secrets.io
          path: external-secrets
          version: ${EXTERNAL_SECRETS_OPERATOR_VERSION}
          repository: charts/external-secrets-operator

      - name: external-secrets-operator-image
        version: ${EXTERNAL_SECRETS_OPERATOR_VERSION}
        type: ociImage
        input:
          type: ociImage
          path: ghcr.io/external-secrets/external-secrets:${EXTERNAL_SECRETS_OPERATOR_VERSION}
          repository: images/external-secrets-operator

      - name: envoy-chart
        version: ${ENVOY_GATEWAY_CHART_VERSION}
        type: helmChart
        input:
          type: ociImage
          path: docker.io/envoyproxy/gateway-helm:${ENVOY_GATEWAY_CHART_VERSION#v}
          repository: charts/envoy-gateway

      - name: envoy-proxy-image
        version: ${ENVOY_PROXY_IMAGE_VERSION}
        type: ociImage
        input:
          type: ociImage
          path: docker.io/envoyproxy/envoy:distroless-${ENVOY_PROXY_IMAGE_VERSION}
          repository: images/envoy-proxy

      - name: envoy-gateway-image
        version: ${ENVOY_GATEWAY_IMAGE_VERSION}
        type: ociImage
        input:
          type: ociImage
          path: docker.io/envoyproxy/gateway:${ENVOY_GATEWAY_IMAGE_VERSION}
          repository: images/envoy-gateway

      - name: envoy-ratelimit-image
        version: v0.0.0-latest
        type: ociImage
        input:
          type: ociImage
          path: docker.io/envoyproxy/ratelimit:${ENVOY_RATELIMIT_IMAGE_VERSION}
          repository: images/envoy-ratelimit

    sources:
      - access:
          ref: "refs/tags/${OPENMCP_VERSION}"
          commit: "${OPENMCP_VERSION_COMMIT}"
          type: gitHub
          repoUrl: https://github.com/openmcp-project/openmcp
        name: openmcp
        type: git
        version: ${OPENMCP_VERSION}
